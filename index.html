<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø§Ø±ÙƒØª Ø§Ù„ÙƒØ§Ø¨ÙŠÙ†Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f8fafc; }
        .navy-blue { background-color: #1e3a8a; }
        .product-img { width: 70px; height: 70px; object-fit: cover; border-radius: 12px; }
    </style>
</head>
<body class="pb-24">

    <header class="navy-blue text-white p-6 text-center shadow-md border-b-4 border-yellow-400">
        <h1 class="text-2xl font-bold">ğŸ  Ù…Ø§Ø±ÙƒØª Ø§Ù„ÙƒØ§Ø¨ÙŠÙ†Ø©</h1>
        <p class="text-yellow-400 text-sm mt-1">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±</p>
    </header>

    <div class="sticky top-0 z-50 p-4 bg-gray-50/90 backdrop-blur-md">
        <input type="text" id="mainSearch" onkeyup="doSearch()" 
               placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø§Ø¯Ø©..." 
               class="w-full p-4 rounded-2xl border-2 border-blue-900 outline-none text-lg shadow-sm">
    </div>

    <main class="max-w-md mx-auto px-4">
        <div id="loader" class="text-center py-20 font-bold text-blue-900 animate-pulse">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©...</div>
        <div id="items-grid" class="space-y-3"></div>
    </main>

    <div id="cart-float" class="fixed bottom-4 left-1/2 -translate-x-1/2 w-[94%] max-w-sm bg-blue-900 text-white p-4 rounded-2xl shadow-2xl flex justify-between items-center hidden z-50">
        <div>
            <p class="text-xs text-yellow-300">Ø§Ù„Ø³Ù„Ø©:</p>
            <p class="text-xl font-bold"><span id="total-price">0</span> Ø¯.Ø¹</p>
        </div>
        <button onclick="checkout()" class="bg-yellow-400 text-blue-900 px-6 py-3 rounded-xl font-bold shadow-lg">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ğŸ“²</button>
    </div>

    <script>
        const API_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR_Ja8kz5VAApLStZ9Y_erhYNqL3eXMafTSR9T8xkI82UzYQMS_efXuIyASXRKZTwYZGp69ExZB-7r3/pub?output=csv';

        let allProducts = [];

        async function init() {
            try {
                const res = await fetch(API_URL + '&t=' + Date.now());
                const csv = await res.text();
                const lines = csv.split('\n').slice(1);
                
                allProducts = lines.map(line => {
                    const parts = line.split(/,(?=(?: iconography(?:[^"]*"){2})*[^"]*$)/);
                    if(parts.length >= 2) {
                        return { 
                            name: parts[0].replace(/"/g, '').trim(), 
                            price: parseInt(parts[1].trim()) || 0,
                            img: parts[2] ? parts[2].trim() : '' 
                        };
                    }
                }).filter(p => p && p.name);

                render(allProducts);
                document.getElementById('loader').classList.add('hidden');
            } catch (err) {
                document.getElementById('loader').innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
            }
        }

        function render(data) {
            const grid = document.getElementById('items-grid');
            grid.innerHTML = data.map(p => {
                // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø¥ÙƒØ³Ù„ØŒ Ù†Ø¶Ø¹ ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù…Ø±ØªØ¨Ø©
                const imageSrc = p.img ? (p.img.startsWith('http') ? p.img : `images/${p.img}`) : `https://ui-avatars.com/api/?name=${encodeURIComponent(p.name)}&background=1e3a8a&color=fff&size=128`;
                
                return `
                <div class="bg-white p-3 rounded-xl shadow-sm border-r-4 border-yellow-400 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <img src="${imageSrc}" class="product-img bg-gray-100" onerror="this.src='https://via.placeholder.com/70?text=%D9%85%D8%A7%D8%AF%D8%A9'">
                        <div>
                            <h3 class="font-bold text-gray-800 text-sm leading-tight">${p.name}</h3>
                            <p class="text-blue-700 font-extrabold mt-1">${p.price.toLocaleString()} Ø¯.Ø¹</p>
                        </div>
                    </div>
                    <button onclick="addToCart('${p.name}', ${p.price})" class="bg-yellow-400 text-blue-900 w-10 h-10 rounded-full font-bold shadow text-xl">+</button>
                </div>`;
            }).join('');
        }

        function doSearch() {
            const query = document.getElementById('mainSearch').value.toLowerCase();
            const filtered = allProducts.filter(p => p.name.toLowerCase().includes(query));
            render(filtered);
        }

        let cart = [], total = 0;
        function addToCart(n, p) {
            cart.push(n);
            total += p;
            document.getElementById('total-price').innerText = total.toLocaleString();
            document.getElementById('cart-float').classList.remove('hidden');
        }

        function checkout() {
            let msg = "*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ù…Ø§Ø±ÙƒØª Ø§Ù„ÙƒØ§Ø¨ÙŠÙ†Ø©*%0a------------------%0a";
            cart.forEach((m, i) => msg += `${i+1}. ${m}%0a`);
            msg += "------------------%0a";
            msg += `*Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${total.toLocaleString()} Ø¯.Ø¹*`;
            window.open(`https://wa.me/9647760982880?text=${msg}`);
        }

        init();
    </script>
</body>
</html>
